LBCtest %>%
  describe %>%
  as.data.frame() %>%
  rownames_to_column(., var = "variable")%>%
  select(variable, mean, sd, skew, kurtosis)%>%
  kable(digits = 2)%>%
  kable_styling(full_width = F)

LBCtest %>%
  pivot_longer(2:11, names_to = "variable", values_to="score") %>%
  ggplot(aes(x=score))+
  geom_density()+
  facet_wrap(~variable)+
  theme_light()



#RMSEA, SRMR .05; TLI, CFI .95
#CFA

modelcholes <- '
cholesbio =~ bld_hdlchol_w1 + bld_hdlrat_w1 + bld_triglyc_w1
choles =~ cholesbio + hichol_w1

choles ~ sex
choles ~ lonely_w1
choles ~ livealn_w1
choles ~ hiqual_w1
choles ~ phyactiv_w1
choles ~ hmsonum_w1
choles ~ hadstot_w1


'
modelfitcholes <- cfa(modelcholes, LBC1936, std.lv = T)
summary(modelfitcholes, fit = T, standardized = T)
modindices(modelfitcholes, sort = T)

summary(LBC$bld_crprot_w1)

modelbp <-'
dbp =~ dbp1sit_w1 + dbp2sit_w1 + dbp3sit_w1 + dbp1std_w1 + dbp2std_w1 + dbp3std_w1
sbp =~ sbp1sit_w1 + sbp2sit_w1 + sbp3sit_w1 + sbp1std_w1 + sbp2std_w1 + sbp3std_w1
bpbio =~ dbp + sbp
bp =~ bpbio + hibp_w1


bp ~ sex
bp ~ lonely_w1
bp ~ livealn_w1
bp ~ hiqual_w1
bp ~ phyactiv_w1
bp ~ hmsonum_w1
bp ~ hadstot_w1
'
modelfitbp <- cfa(modelbp, LBC1936, std.lv = T)
summary(modelfitbp, fit = T, standardized = T)
modindices(modelfitbp, sort = T)
semPaths(modelfitbp, what="paths")

modelcardio <-'
cardio =~ bld_crprot_w1 + cvdhist_w1  


cardio ~ sex
cardio ~ lonely_w1
cardio ~ livealn_w1
cardio ~ hiqual_w1
cardio ~ phyactiv_w1
cardio ~ hmsonum_w1
cardio ~ hadstot_w1
'
modelfitcardio <- cfa(modelcardio, LBC1936, std.lv = T)
summary(modelfitcardio, fit = T, standardized = T)
modindices(modelfitcardio, sort = T)

modeldiab <-'
diab =~ bld_hba1c_w1 + diab_w1

diab ~ sex
diab ~ lonely_w1
diab ~ livealn_w1
diab ~ hiqual_w1
diab ~ phyactiv_w1
diab ~ hmsonum_w1
diab ~ hadstot_w1
'
modelfitdiab <- cfa(modeldiab, LBC1936, std.lv = T)
summary(modelfitdiab, fit = T, standardized = T)
modindices(modelfitdiab, sort = T)



modelstroke <-'stroke =~ stroke_mask_w2

stroke ~ sex
stroke ~ lonely_w1
stroke ~ livealn_w1
stroke ~ hiqual_w1
stroke ~ phyactiv_w1
stroke ~ hmsonum_w1
stroke ~ hadstot_w1'
modelfitstroke <- cfa(modelstroke, LBC1936, std.lv = T)
summary(modelfitstroke, fit = T, standardized = T)
modindices(modelfitstroke, sort = T)


modeldemen <-'dementia =~ dementia_code


dementia ~ sex
dementia ~ lonely_w1
dementia ~ livealn_w1
dementia ~ hiqual_w1
dementia ~ phyactiv_w1
dementia ~ hmsonum_w1
dementia ~ hadstot_w1
'
modelfitdemen <- cfa(modeldemen, LBC1936, std.lv = T)
summary(modelfitdemen, fit = T, standardized = T)
modindices(modelfitdemen, sort = T)


#SEM 


test <- '

cholesbio =~ bld_hdlchol_w1 + bld_triglyc_w1
choles =~ cholesbio + hichol_w1

dbp =~ dbp1sit_w1 + dbp2sit_w1 + dbp3sit_w1 + dbp1std_w1 + dbp2std_w1 + dbp3std_w1
sbp =~ sbp1sit_w1 + sbp2sit_w1 + sbp3sit_w1 + sbp1std_w1 + sbp2std_w1 + sbp3std_w1
bpbio =~ dbp + sbp
bp =~ bpbio + hibp_w1

cardio =~ bld_crprot_w1 + cvdhist_w1

diab =~ bld_hba1c_w1 + diab_w1

risk =~ choles + bp + cardio + diab + stroke_mask_w2 #+ dementia_code

risk ~ c*lonely_w1
risk ~ sex
risk ~ b*phyactiv_w1
risk ~ hmsonum_w1
risk ~ hadstot_w1
risk ~ hiqual_w1

bio ~ lonely_w1
bio ~ sex 



phyactiv_w1 ~ a*lonely_w1

bio =~ cholesbio + bpbio + bld_crprot_w1 + bld_hba1c_w1 + stroke_mask_w2



#Indirect
ind2:=a*b

#Total
TotalBio:=c+a*b




'

test_fit <- sem(test, LBC1936, 
                    missing = 'FIML')
summary(test_fit, fit.measures = T, standardized =T, ci = T)
modindices(test_fit, sort = T)
resid(test_fit, type="cor")

covariancsemPaths(test_fit, what='paths')


sbp ~~ vSBP * sbp
vSBP > 0


semmodel_w1 <- '

cholesbio =~ bld_hdlchol_w1 + bld_triglyc_w1
choles =~ cholesbio + hichol_w1

dbp =~ dbp1sit_w1 + dbp2sit_w1 + dbp3sit_w1 + dbp1std_w1 + dbp2std_w1 + dbp3std_w1
sbp =~ sbp1sit_w1 + sbp2sit_w1 + sbp3sit_w1 + sbp1std_w1 + sbp2std_w1 + sbp3std_w1
bpbio =~ dbp + sbp
bp =~ bpbio + hibp_w1

cardio =~ bld_crprot_w1 + cvdhist_w1

diab =~ bld_hba1c_w1 + diab_w1

choles ~ lonely_w1
choles ~ sex
choles ~ phyactiv_w1
choles ~ hmsonum_w1
choles ~ hadstot_w1
choles ~ hiqual_w1

bp ~ lonely_w1
bp ~ sex
bp ~ phyactiv_w1
bp ~ hmsonum_w1
bp ~ hadstot_w1
bp ~ hiqual_w1

cardio ~ lonely_w1
cardio ~ sex
cardio ~ phyactiv_w1
cardio ~ hmsonum_w1
cardio ~ hadstot_w1
cardio ~ hiqual_w1

diab ~ lonely_w1
diab ~ sex
diab ~ phyactiv_w1
diab ~ hmsonum_w1
diab ~ hadstot_w1
diab ~ hiqual_w1

stroke_mask_w2 ~ lonely_w1
stroke_mask_w2 ~ sex
stroke_mask_w2 ~ phyactiv_w1
stroke_mask_w2 ~ hmsonum_w1
stroke_mask_w2 ~ hadstot_w1
stroke_mask_w2 ~ hiqual_w1

dementia_code ~ lonely_w1
dementia_code ~ sex
dementia_code ~ phyactiv_w1
dementia_code ~ hmsonum_w1
dementia_code ~ hadstot_w1
dementia_code ~ hiqual_w1


cholesbio ~~ bpbio
cholesbio ~~ bld_crprot_w1
cholesbio ~~ bld_hba1c_w1
bpbio ~~ bld_crprot_w1
bpbio ~~ bld_hba1c_w1
bld_crprot_w1 ~~ bld_hba1c_w1

hichol_w1 ~~     cvdhist_w1
hichol_w1 ~~        hibp_w1
hichol_w1 ~~ diab_w1
cvdhist_w1 ~~        hibp_w1
hibp_w1 ~~ diab_w1
cvdhist_w1 ~~ diab_w1

choles ~~ bp
choles ~~ cardio
choles ~~ diab
bp ~~ cardio
bp ~~ diab
cardio ~~ diab


phyactiv_w1 ~ a*lonely_w1


#Indirect
#ind2:=a*b

#Total
#TotalBio:=c+a*b




'

sem_model_w1 <- sem(semmodel_w1, LBC1936, 
                    missing = 'FIML')
summary(sem_model_w1, fit.measures = T, standardized =T, ci = T)


covariancsemPaths(sem_model_w1, what='paths')
modindices(sem_model_w1, sort = T)








semmodel_w1 <- '

cholesbio =~ bld_hdlchol_w1 + bld_triglyc_w1
choles =~ cholesbio + hichol_w1

dbp =~ dbp1sit_w1 + dbp2sit_w1 + dbp3sit_w1 + dbp1std_w1 + dbp2std_w1 + dbp3std_w1
sbp =~ sbp1sit_w1 + sbp2sit_w1 + sbp3sit_w1 + sbp1std_w1 + sbp2std_w1 + sbp3std_w1
bpbio =~ dbp + sbp
bp =~ bpbio + hibp_w1

cardio =~ bld_crprot_w1 + cvdhist_w1

diab =~ bld_hba1c_w1 + diab_w1

choles ~ lonely_w1
choles ~ sex
choles ~ phyactiv_w1
choles ~ hmsonum_w1
choles ~ hadstot_w1
choles ~ hiqual_w1

bp ~ lonely_w1
bp ~ sex
bp ~ phyactiv_w1
bp ~ hmsonum_w1
bp ~ hadstot_w1
bp ~ hiqual_w1

cardio ~ lonely_w1
cardio ~ sex
cardio ~ phyactiv_w1
cardio ~ hmsonum_w1
cardio ~ hadstot_w1
cardio ~ hiqual_w1

diab ~ lonely_w1
diab ~ sex
diab ~ phyactiv_w1
diab ~ hmsonum_w1
diab ~ hadstot_w1
diab ~ hiqual_w1

stroke_mask_w2 ~ lonely_w1
stroke_mask_w2 ~ sex
stroke_mask_w2 ~ phyactiv_w1
stroke_mask_w2 ~ hmsonum_w1
stroke_mask_w2 ~ hadstot_w1
stroke_mask_w2 ~ hiqual_w1

dementia_code ~ lonely_w1
dementia_code ~ sex
dementia_code ~ phyactiv_w1
dementia_code ~ hmsonum_w1
dementia_code ~ hadstot_w1
dementia_code ~ hiqual_w1


phyactiv_w1 ~ a*lonely_w1

cholesbio ~ lonely_w1
cholesbio ~ sex
cholesbio ~ phyactiv_w1
cholesbio ~ hmsonum_w1
cholesbio ~ hadstot_w1
cholesbio ~ hiqual_w1

bpbio ~ lonely_w1
bpbio ~ sex
bpbio ~ phyactiv_w1
bpbio ~ hmsonum_w1
bpbio ~ hadstot_w1
bpbio ~ hiqual_w1

bld_crprot_w1 ~ lonely_w1
bld_crprot_w1 ~ sex
bld_crprot_w1 ~ phyactiv_w1
bld_crprot_w1 ~ hmsonum_w1
bld_crprot_w1 ~ hadstot_w1
bld_crprot_w1 ~ hiqual_w1

bld_hba1c_w1 ~ lonely_w1
bld_hba1c_w1 ~ sex
bld_hba1c_w1 ~ phyactiv_w1
bld_hba1c_w1 ~ hmsonum_w1
bld_hba1c_w1 ~ hadstot_w1
bld_hba1c_w1 ~ hiqual_w1




hichol_w1 ~ lonely_w1
hichol_w1 ~ sex
hichol_w1 ~ phyactiv_w1
hichol_w1 ~ hmsonum_w1
hichol_w1 ~ hadstot_w1
hichol_w1 ~ hiqual_w1

hibp_w1 ~ lonely_w1
hibp_w1 ~ sex
hibp_w1 ~ phyactiv_w1
hibp_w1 ~ hmsonum_w1
hibp_w1 ~ hadstot_w1
hibp_w1 ~ hiqual_w1

cvdhist_w1 ~ lonely_w1
cvdhist_w1 ~ sex
cvdhist_w1 ~ phyactiv_w1
cvdhist_w1 ~ hmsonum_w1
cvdhist_w1 ~ hadstot_w1
cvdhist_w1 ~ hiqual_w1

diab_w1 ~ lonely_w1
diab_w1 ~ sex
diab_w1 ~ phyactiv_w1
diab_w1 ~ hmsonum_w1
diab_w1 ~ hadstot_w1
diab_w1 ~ hiqual_w1





cholesbio ~~ bpbio
cholesbio ~~ bld_crprot_w1
cholesbio ~~ bld_hba1c_w1
cholesbio ~~ stroke_mask_w2
cholesbio ~~ dementia_code

bpbio ~~ bld_crprot_w1
bpbio ~~ bld_hba1c_w1
bpbio ~~ stroke_mask_w2
bpbio ~~ dementia_code

bld_crprot_w1 ~~ bld_hba1c_w1
bld_crprot_w1 ~~ stroke_mask_w2
bld_crprot_w1 ~~ dementia_code

bld_hba1c_w1 ~~ stroke_mask_w2
bld_hba1c_w1 ~~ dementia_code

stroke_mask_w2 ~~ dementia_code

hichol_w1 ~~ bpbio
hichol_w1 ~~ bld_crprot_w1
hichol_w1 ~~ bld_hba1c_w1
hichol_w1 ~~ stroke_mask_w2
hichol_w1 ~~ dementia_code

hibp_w1 ~~ bld_crprot_w1
hibp_w1 ~~ bld_hba1c_w1
hibp_w1 ~~ stroke_mask_w2
hibp_w1 ~~ dementia_code

cvdhist_w1 ~~ bld_hba1c_w1
cvdhist_w1 ~~ stroke_mask_w2
cvdhist_w1 ~~ dementia_code

diab_w1  ~~ stroke_mask_w2
diab_w1  ~~ dementia_code




#Indirect
#ind2:=a*b

#Total
#TotalBio:=c+a*b




'
