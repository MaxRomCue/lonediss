#SEM - US



?select

#CFAs

modelcholes <- '
cholesbio =~ hdl + trig 
choleself =~ hcheat + hcang  + hccor
choles =~ cholesbio + choleself

lone =~ i_sclonely + i_scisolate + i_scleftout + i_sclackcom
physical =~ i_vday + i_mday + i_wday

choles ~ i_dvage
choles ~ i_sex
choles ~ lone
choles ~ i_finnow
choles ~ physical
choles ~ i_hhsize


#added co-variances
#lone  ~    i_finnow

'
modelfitcholes <- cfa(modelcholes, USoc, std.lv = T)
summary(modelfitcholes, fit = T, standardized = T)
modindices(modelfitcholes, sort = T)


modelbp <-'
bpbio =~ omdiaval + omsysval
bpself =~ hcbp 
bp =~ bpbio + bpself

lone =~ i_sclonely + i_scisolate + i_scleftout + i_sclackcom
physical =~ i_vday + i_mday + i_wday

bp ~ i_dvage
bp ~ i_sex 
bp ~ lone
bp ~ i_finnow
bp ~ physical
bp ~ i_hhsize

'
modelfitbp <- cfa(modelbp, USoc, std.lv = T)
summary(modelfitbp, fit = T, standardized = T)
modindices(modelfitbp, sort = T)



modelcardio <-'
cardiobio=~ hscrp 
cardiorep =~ hcharth
cardio =~ cardiobio + cardiorep  

physical =~ i_vday + i_mday + i_wday

cardio ~ i_dvage
cardio ~ i_sex 
cardio ~ physical

' 
modelfitcardio <- cfa(modelcardio, USoc, std.lv = T)
summary(modelfitcardio, fit = T, standardized = T)
modindices(modelfitcardio, sort = T)


modeldiab <-'
diab =~ hba1c + hcdiab

physical =~ i_vday + i_mday + i_wday

diab ~ i_dvage
diab ~ i_sex 
diab ~ physical
'
modelfitdiab <- cfa(modeldiab, USoc, std.lv = T)
summary(modelfitdiab, fit = T, standardized = T)
modindices(modelfitcardio, sort = T)


#Need to Scale

USoc$i_sf12pcs_dv <- scale(USoc$i_sf12pcs_dv)
USoc$i_sf12mcs_dv <- scale(USoc$i_sf12mcs_dv)
USoc$i_sclfsato <- scale(USoc$i_sclfsato)
USoc$c_big5n_dv <- scale(USoc$c_big5n_dv)



sem_model <- sem(semmodel, USoc, 
                 #se = 'bootstrap',
                 missing = 'fiml')
summary(sem_model, fit.measures = T, standardized =T, ci = T)
modindices(sem_model, sort = T)

test <- '

cholesbio =~ hdl + trig 
choleself =~ hcheat + hcang  + hccor 
choles =~ cholesbio + choleself

bp =~ omdiaval + omsysval + hcbp

cardio =~ hscrp + hcharth 

diab =~ hba1c + hcdiab

#chronic health index (higher values is having worse outcomes)
risk =~ choles + bp + cardio + diab

#loneliness (higher values is being more lonely)
lone =~ i_sclonely + i_scisolate + i_scleftout + i_sclackcom

#physical activity (higher values is exercising more)
physical =~ i_vday + i_mday + i_wday

#self report (higher values is having better outcomes)
#selfphy =~ i_sf12pcs_dv + i_sf12mcs_dv + i_health
self =~ i_sf12mcs_dv + i_sclfsato 


#neuroticism
neuro =~ c_scptrt5n1 + c_scptrt5n2 + c_scptrt5n3

risk ~~ neuro
self ~~ neuro


risk ~ i_dvage
risk ~ i_sex
risk ~ c2*lone
risk ~ i_hhsize
risk ~ i_finnow
risk ~ b2*physical

self ~ i_dvage
self ~ i_sex
self ~ c1*lone
self ~ i_hhsize
self ~ i_finnow
self ~ b1*physical

bio =~ cholesbio + bpbio + hscrp + hba1c 

bio ~ lone
bio ~ i_sex
bio ~ i_dvage

physical~a2*lone

#Indirect
ind2:=a2*b2

#Total
TotalSelf:=c1+a2*b1
TotalBio:=c2+a2*b2

Total:=TotalSelf - TotalBio

#MODINDICES
#lone  ~     i_finnow
'

test_fit <- sem(test, USoc, 
                missing = 'FIML')
summary(test_fit, fit.measures = T, standardized =T, ci = T)
modindices(test_fit, sort = T)




sem_model <- '

cholesbio =~ hdl + trig 
choleself =~ hcheat + hcang  + hccor 
choles =~ choleself + cholesbio

bp =~ omdiaval + omsysval + hcbp

cardio =~ hscrp + hcharth 

diab =~ hba1c + hcdiab


#loneliness (higher values is being more lonely)
lone =~ i_sclonely + i_scisolate + i_scleftout + i_sclackcom

#physical activity (higher values is exercising more)
physical =~ i_vday + i_mday + i_wday

choles ~ i_dvage
choles ~ i_sex
choles ~ c1*lone
choles ~ i_hhsize
choles ~ i_finnow
choles ~ b1*physical

bp ~ i_dvage
bp ~ i_sex
bp ~ c2*lone
bp ~ i_hhsize
bp ~ i_finnow
bp ~ b2*physical

cardio ~ i_dvage
cardio ~ i_sex
cardio ~ c3*lone
cardio ~ i_hhsize
cardio ~ i_finnow
cardio ~ b3*physical


diab ~ i_dvage
diab ~ i_sex
diab ~ c4*lone
diab ~ i_hhsize
diab ~ i_finnow
diab ~ b4*physical



physical~a*lone

#Indirect
Indcholes:=a*b1
Indbp:=a*b2
Indcardio:=a*b3
Inddiab:=a*b4


#Total
TotalCholes:=c1+a*b1
TotalBP:=c2+a*b2
TotalCardio:=c3+a*b3
TotalDiab:=c4+a*b4

HealthIndex:=TotalCholes + TotalBP + TotalCardio + TotalDiab

#Biomarker covariances
trig ~~ hba1c
trig ~~ hscrp
trig ~~ omdiaval
trig ~~ omsysval
hdl ~~ hba1c
hdl ~~ hscrp
hdl ~~ omdiaval 
hdl ~~ omsysval
hba1c ~~ hscrp
hba1c ~~ omdiaval 
hba1c ~~ omsysval
hscrp ~~ omdiaval 
hscrp ~~ omsysval 


#Self-Report Covariances
hcheat ~~ hcbp
hcheat ~~ hcharth
hcheat ~~ hcdiab
hcang ~~ hcbp
hcang ~~ hcharth
hcang ~~ hcdiab
hccor ~~ hcbp
hccor ~~ hcharth
hccor ~~ hcdiab
hcbp ~~ hcharth
hcbp ~~ hcdiab
hcharth ~~ hcdiab


lone  ~ i_finnow
'



sem_modelfit <- sem(sem_model, USoc, 
                missing = 'FIML')
summary(sem_modelfit, fit.measures = T, standardized =T, ci = T)
modindices(sem_modelfit, sort = T)


lavInspect(sem_modelfit, "cov.lv")


USoc %>% 
  select(starts_with("i")) %>% 
  describe %>% 
  as.data.frame() %>%
  rownames_to_column(., var = "variable") %>% 
  select(variable,n, mean,sd,skew,kurtosis) %>%
  kable(digits = 2) %>%
  kable_styling(full_width = FALSE)

?select
